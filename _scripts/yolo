#!/usr/bin/env zsh
# WARNING: This script runs Claude with DANGEROUS permissions
# Only use when you absolutely need full system access
# ğŸ”¥ YOLO - You Only Live Once ğŸ”¥

set -euo pipefail

# Ensure we're in the repo directory
# If REPO_PATH is set, use it; otherwise derive from script location
if [[ -z "${REPO_PATH:-}" ]]; then
  REPO_PATH="$(cd "$(dirname "$0")/.." && pwd)"
fi
cd "$REPO_PATH"

# Set terminal color to bright red (for YOLO mode) - only works on host
term-color brightred

# On macOS host, set window and font size for better visibility
if [[ "$OSTYPE" == "darwin"* ]] && [[ ! -f /.dockerenv ]]; then
  osascript <<OSA
tell application "Terminal"
  tell front window
    set number of rows to 40
    set number of columns to 120
    set font size of current settings to 12
  end tell
end tell
OSA
fi

# Show git status
echo "==================================== Git Status ===================================="
git status

# Check Claude usage (optional - continues on error)
echo -e "\n==================================== Claude Usage ===================================="
# Use globally installed ccusage if available, otherwise skip
if command -v ccusage &> /dev/null; then
    ccusage monthly 2>/dev/null || echo "Claude usage stats unavailable (ccusage tool error)"
else
    echo "Claude usage stats unavailable (ccusage not installed)"
fi

# YOLO warning with skull and fire
echo -e "\n==================================== ğŸ”¥ YOLO MODE ğŸ”¥ ===================================="
echo "ğŸ’€ WARNING: --dangerously-skip-permissions is enabled!"
echo "ğŸš¨ Claude will have FULL ACCESS to:"
echo "   â€¢ Execute ANY command on your system"
echo "   â€¢ Read/write/delete ANY file"
echo "   â€¢ Access ALL environment variables and secrets"
echo ""
echo "ğŸ“ Working directory: $REPO_PATH"
echo "ğŸ¯ Running as user: $(whoami)"

# Extra warning if NOT in Docker
if [[ ! -f /.dockerenv ]] && [[ ! -d /aimeup ]]; then
  echo ""
  echo "ğŸš¨ğŸš¨ğŸš¨ EXTRA WARNING: You are NOT in a Docker container! ğŸš¨ğŸš¨ğŸš¨"
  echo "This means Claude will have access to your ENTIRE HOST SYSTEM!"
  echo ""
  echo "Type 'YOLO ON HOST' to confirm you want to run with dangerous permissions on host:"
  read -r CONFIRM
  if [[ "$CONFIRM" != "YOLO ON HOST" ]]; then
    echo "âŒ Aborted - you did not type 'YOLO ON HOST'"
    exit 1
  fi
else
  echo ""
  echo "ğŸ³ Running in Docker container (somewhat safer)"
fi

echo ""
echo "âš ï¸  Only proceed if you understand and accept the risks!"
echo "Press Enter to continue or Ctrl+C to abort..."

read -r

# Start Claude in YOLO mode
echo -e "\nğŸ”¥ Starting Claude in YOLO mode..."
# Pass any command-line arguments to claude
if [[ $# -gt 0 ]]; then
    echo "ğŸ“ With parameters: $*"
    claude --dangerously-skip-permissions "$@"
else
    claude --dangerously-skip-permissions
fi

# Restore terminal color to lightgray (same as aimeterm)
term-color lightgray
echo -e "\nâœ… Exited YOLO mode - terminal restored to lightgray"